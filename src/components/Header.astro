---
const navLinks = [
  { href: '/',         label: 'Home'     },
  { href: '/about',   label: 'About'    },
  { href: '/blog',    label: 'Blog'     },
  { href: '/projects',label: 'Projects' },
  { href: '/podcast', label: 'Podcast'  },
];

const currentPath = Astro.url.pathname;
---

<header style="background:var(--bg); border-bottom:1px solid var(--border);" class="sticky top-0 z-50">
  <nav class="max-w-3xl mx-auto px-6 h-14 flex items-center justify-between">
    <!-- Logo -->
    <a href="/" style="color:var(--fg);" class="font-semibold text-base tracking-tight hover:opacity-70 transition-opacity shrink-0">
      <span class="hidden sm:inline">Raviteja Tholupunoori</span>
      <span class="sm:hidden">Raviteja</span>
    </a>

    <div class="flex items-center gap-3">
      <!-- Desktop nav -->
      <ul class="hidden sm:flex items-center gap-5 list-none m-0 p-0">
        {navLinks.map(({ href, label }) => {
          const isActive = href === '/' ? currentPath === '/' : currentPath.startsWith(href);
          return (
            <li>
              <a
                href={href}
                style={isActive ? 'color:var(--accent);' : 'color:var(--fg-muted);'}
                class="text-sm font-medium hover:opacity-80 transition-opacity"
              >
                {label}
              </a>
            </li>
          );
        })}
      </ul>

      <!-- Dark / Light toggle -->
      <button
        id="theme-toggle"
        aria-label="Toggle dark/light mode"
        style="color:var(--fg-muted); background:none; border:none;"
        class="cursor-pointer p-1 rounded-md hover:opacity-70 transition-opacity text-lg leading-none"
      >
        <span id="theme-icon">‚òÄÔ∏è</span>
      </button>

      <!-- Mobile hamburger -->
      <button
        id="menu-toggle"
        aria-label="Toggle menu"
        style="color:var(--fg-muted); background:none; border:none;"
        class="sm:hidden cursor-pointer p-1 rounded-md hover:opacity-70 transition-opacity text-xl leading-none"
      >
        <span id="menu-icon">‚ò∞</span>
      </button>
    </div>
  </nav>

  <!-- Mobile dropdown -->
  <div id="mobile-menu" style="display:none; border-top:1px solid var(--border); background:var(--bg);">
    <ul class="list-none m-0 px-6 py-4 flex flex-col gap-4">
      {navLinks.map(({ href, label }) => {
        const isActive = href === '/' ? currentPath === '/' : currentPath.startsWith(href);
        return (
          <li>
            <a
              href={href}
              style={isActive ? 'color:var(--accent); font-weight:600;' : 'color:var(--fg-muted);'}
              class="text-base hover:opacity-80 transition-opacity"
            >
              {label}
            </a>
          </li>
        );
      })}
    </ul>
  </div>
</header>

<script is:inline>
  (function () {
    const root = document.documentElement;
    const stored = localStorage.getItem('theme');
    const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
    const theme = stored ?? (prefersDark ? 'dark' : 'light');
    root.setAttribute('data-theme', theme);

    function updateIcon() {
      const icon = document.getElementById('theme-icon');
      if (icon) icon.textContent = root.getAttribute('data-theme') === 'dark' ? '‚òÄÔ∏è' : 'üåô';
    }
    updateIcon();

    document.getElementById('theme-toggle')?.addEventListener('click', () => {
      const next = root.getAttribute('data-theme') === 'dark' ? 'light' : 'dark';
      root.setAttribute('data-theme', next);
      localStorage.setItem('theme', next);
      updateIcon();
    });

    const menuToggle = document.getElementById('menu-toggle');
    const mobileMenu = document.getElementById('mobile-menu');
    const menuIcon = document.getElementById('menu-icon');
    menuToggle?.addEventListener('click', () => {
      const isOpen = mobileMenu.style.display === 'block';
      mobileMenu.style.display = isOpen ? 'none' : 'block';
      menuIcon.textContent = isOpen ? '‚ò∞' : '‚úï';
    });
  })();
</script>
