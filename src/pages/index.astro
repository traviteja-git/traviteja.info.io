---
import BaseLayout from '../layouts/BaseLayout.astro';
import BlogCard from '../components/BlogCard.astro';
import { getCollection } from 'astro:content';
import { projects, relativeTime } from '../data/projects';

const allPosts = (await getCollection('blog'))
  .filter(p => !p.data.draft)
  .sort((a, b) => new Date(b.data.date).getTime() - new Date(a.data.date).getTime())
  .slice(0, 3);

const recentProjects = [...projects].reverse().slice(0, 4);
---

<BaseLayout
  title="Raviteja Tholupunoori | Data Engineer & Airflow Champion"
  description="Senior Data Engineer & Cloud Architect with 9+ yrs building scalable data pipelines on GCP, AWS and Azure. Apache Airflow Champion at Deloitte."
  image="https://traviteja.com/og-default.png"
>
  <!-- Hero -->
  <section class="mb-12">
    <!-- Mobile: stacked, Desktop: side-by-side -->
    <div class="flex flex-col sm:flex-row sm:items-start sm:gap-6 gap-4">
      <img
        src="/avatar.jpg"
        alt="Raviteja Tholupunoori"
        width="100"
        height="100"
        class="w-20 h-20 sm:w-[100px] sm:h-[100px] flex-shrink-0"
        style="border-radius:50%; object-fit:cover; object-position:center top; border:2px solid var(--border);"
      />
      <div style="flex:1; min-width:0;">
        <h1 class="text-2xl sm:text-3xl" style="color:var(--fg); font-weight:700; line-height:1.2; margin:0 0 0.25rem;">
          Raviteja Tholupunoori
        </h1>
        <p style="color:var(--fg-muted); font-size:0.875rem; margin:0 0 0.5rem; font-weight:500;">
          Sr. Engineer / Cloud Architect ¬∑ <strong style="color:var(--fg);">Deloitte</strong>
        </p>
        <p style="color:var(--fg-muted); font-size:0.78rem; margin:0 0 0.9rem;">
          üìç Hyderabad, India &nbsp;¬∑&nbsp; üèÜ Airflow Champion &nbsp;¬∑&nbsp; ‚òÅÔ∏è GCP ¬∑ AWS ¬∑ Azure
        </p>
        <p style="color:var(--fg-muted); font-size:0.92rem; margin:0 0 1.25rem; line-height:1.7; max-width:38rem;">
          Sr. Engineer / Cloud Architect specializing in Identity Resolution &amp; Multi-Cloud Data Platforms. 9+ years turning raw, messy customer data into unified, actionable intelligence.
        </p>
        <div style="display:flex; align-items:center; gap:0.5rem; flex-wrap:wrap;">
          <a href="/about"
             style="background:var(--fg); color:var(--bg); border-radius:8px; padding:0.45rem 1rem; font-size:0.85rem; font-weight:500; text-decoration:none; white-space:nowrap;"
             class="hover:opacity-80 transition-opacity">
            About me
          </a>
          <a href="/blog"
             style="border:1px solid var(--border); color:var(--fg); border-radius:8px; padding:0.45rem 1rem; font-size:0.85rem; font-weight:500; background:transparent; text-decoration:none; white-space:nowrap;"
             class="hover:border-[var(--accent)] transition-colors">
            Blog
          </a>
          <a href="/Tholupunoori_Raviteja.pdf" target="_blank"
             style="border:1px solid var(--border); color:var(--fg-muted); border-radius:8px; padding:0.45rem 1rem; font-size:0.85rem; font-weight:500; background:transparent; text-decoration:none; white-space:nowrap;"
             class="hover:border-[var(--accent)] hover:text-[var(--fg)] transition-colors">
            Resume ‚Üó
          </a>
          <a href="https://linkedin.com/in/raviteja0096" target="_blank" aria-label="LinkedIn"
             style="color:var(--fg-muted); display:flex; align-items:center; padding:0.45rem; text-decoration:none;"
             class="hover:text-[var(--fg)] transition-colors">
            <svg width="17" height="17" viewBox="0 0 24 24" fill="currentColor"><path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433a2.062 2.062 0 0 1-2.063-2.065 2.064 2.064 0 1 1 2.063 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/></svg>
          </a>
          <a href="https://github.com/traviteja-git" target="_blank" aria-label="GitHub"
             style="color:var(--fg-muted); display:flex; align-items:center; padding:0.45rem; text-decoration:none;"
             class="hover:text-[var(--fg)] transition-colors">
            <svg width="17" height="17" viewBox="0 0 24 24" fill="currentColor"><path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/></svg>
          </a>
          <a href="https://medium.com/@raviteja0096" target="_blank" aria-label="Medium"
             style="color:var(--fg-muted); display:flex; align-items:center; padding:0.45rem; text-decoration:none;"
             class="hover:text-[var(--fg)] transition-colors">
            <svg width="17" height="17" viewBox="0 0 24 24" fill="currentColor"><path d="M13.54 12a6.8 6.8 0 01-6.77 6.82A6.8 6.8 0 010 12a6.8 6.8 0 016.77-6.82A6.8 6.8 0 0113.54 12zM20.96 12c0 3.54-1.51 6.42-3.38 6.42-1.87 0-3.39-2.88-3.39-6.42s1.52-6.42 3.39-6.42 3.38 2.88 3.38 6.42M24 12c0 3.17-.53 5.75-1.19 5.75-.66 0-1.19-2.58-1.19-5.75s.53-5.75 1.19-5.75C23.47 6.25 24 8.83 24 12z"/></svg>
          </a>
        </div>
      </div>
    </div>
  </section>

  <!-- Featured In -->
  <section class="mb-16">
    <p style="color:var(--fg-muted); font-size:0.72rem; font-weight:600; text-transform:uppercase; letter-spacing:0.08em; margin:0 0 0.75rem;">Featured In</p>
    <a href="/podcast" style="text-decoration:none; display:inline-flex; align-items:center; gap:0.75rem; border:1px solid var(--border); border-radius:10px; padding:0.65rem 1rem; background:var(--bg-subtle);" class="hover:border-[var(--accent)] transition-colors">
      <img src="/images/logos/airflow_podcast.png" alt="Astronomer" width="28" height="28" style="border-radius:6px; object-fit:contain;" />
      <div>
        <p style="color:var(--fg); font-size:0.85rem; font-weight:600; margin:0; line-height:1.3;">Astronomer Podcast</p>
        <p style="color:var(--fg-muted); font-size:0.75rem; margin:0;">Apache Airflow in Production ¬∑ 2024</p>
      </div>
      <span style="color:var(--accent); font-size:0.8rem; margin-left:0.5rem;">Listen ‚Üí</span>
    </a>
  </section>

  <!-- Recent posts -->
  {allPosts.length > 0 && (
    <section class="mb-20">
      <div class="flex items-center justify-between mb-6">
        <h2 style="color:var(--fg); font-size:1.1rem; font-weight:600; margin:0;">Recent articles</h2>
        <a href="/blog" style="color:var(--fg-muted); font-size:0.85rem;" class="hover:opacity-70 transition-opacity">
          View all ‚Üí
        </a>
      </div>
      <div class="flex flex-col gap-4">
        {allPosts.map(post => (
          <BlogCard
            title={post.data.title}
            description={post.data.description}
            date={post.data.date}
            slug={post.slug}
            tags={post.data.tags}
            image={post.data.image}
          />
        ))}
      </div>
    </section>
  )}

  <!-- Recent projects -->
  <section class="mb-20">
    <div class="flex items-center justify-between mb-6">
      <h2 style="color:var(--fg); font-size:1.1rem; font-weight:600; margin:0;">Recent projects</h2>
      <a href="/projects" style="color:var(--fg-muted); font-size:0.85rem;" class="hover:opacity-70 transition-opacity">
        View all ‚Üí
      </a>
    </div>
    <div class="grid sm:grid-cols-2 gap-3">
      {recentProjects.map(project => (
        <button
          class="project-card text-left"
          data-title={project.title}
          data-company={project.company}
          data-role={project.role}
          data-period={project.period}
          data-tech={project.tech.join('||')}
          data-description={project.description}
          data-highlights={JSON.stringify(project.highlights)}
          style="border:1px solid var(--border); border-radius:10px; background:var(--bg-subtle); padding:1.1rem 1.25rem; cursor:pointer; display:flex; flex-direction:column; gap:0.65rem; transition:border-color 0.2s; text-align:left;"
          onmouseover="this.style.borderColor='var(--accent)'"
          onmouseout="this.style.borderColor='var(--border)'"
        >
          <div style="display:flex; align-items:flex-start; justify-content:space-between; gap:0.75rem;">
            <h3 style="color:var(--fg); font-size:0.95rem; font-weight:600; margin:0; line-height:1.3; flex:1;">{project.title}</h3>
            <img src={project.logo} alt={project.company} width="28" height="28"
              style="border-radius:6px; object-fit:contain; flex-shrink:0; border:1px solid var(--border); background:var(--bg); padding:2px;" />
          </div>
          <p style="color:var(--fg-muted); font-size:0.82rem; margin:0; line-height:1.5; display:-webkit-box; -webkit-line-clamp:2; -webkit-box-orient:vertical; overflow:hidden;">{project.description}</p>
          <div style="display:flex; flex-wrap:wrap; gap:0.35rem;">
            {project.tech.slice(0, 4).map(t => <span class="tag">{t}</span>)}
            {project.tech.length > 4 && <span class="tag">+{project.tech.length - 4}</span>}
          </div>
          <div style="display:flex; align-items:center; justify-content:space-between;">
            <span style="color:var(--accent); font-size:0.78rem;">View details ‚Üí</span>
            <span style="color:var(--fg-muted); font-size:0.75rem;">{relativeTime(project.endYear)}</span>
          </div>
        </button>
      ))}
    </div>
  </section>

  <!-- Modal (shared for homepage project cards) -->
  <div id="project-modal-backdrop"
    style="display:none; position:fixed; inset:0; z-index:100; background:rgba(0,0,0,0.55); backdrop-filter:blur(4px); -webkit-backdrop-filter:blur(4px); align-items:center; justify-content:center; padding:1rem;">
    <div id="project-modal"
      style="background:var(--bg); border:1px solid var(--border); border-radius:16px; width:100%; max-width:580px; max-height:88vh; overflow-y:auto; box-shadow:0 24px 60px rgba(0,0,0,0.3); transform:scale(0.95); opacity:0; transition:transform 0.2s ease, opacity 0.2s ease;">
      <div style="padding:1.5rem 1.5rem 0; display:flex; align-items:flex-start; justify-content:space-between; gap:1rem;">
        <div style="flex:1; min-width:0;">
          <p id="modal-meta" style="color:var(--fg-muted); font-size:0.75rem; margin:0 0 0.3rem;"></p>
          <h2 id="modal-title" style="color:var(--fg); font-size:1.25rem; font-weight:700; margin:0; line-height:1.3;"></h2>
        </div>
        <button id="modal-close" aria-label="Close"
          style="background:var(--bg-subtle); border:1px solid var(--border); color:var(--fg-muted); border-radius:8px; width:2rem; height:2rem; display:flex; align-items:center; justify-content:center; cursor:pointer; font-size:1.1rem; flex-shrink:0; margin-top:2px; line-height:1;">√ó</button>
      </div>
      <div id="modal-tech" style="padding:1rem 1.5rem 0; display:flex; flex-wrap:wrap; gap:0.4rem;"></div>
      <p id="modal-description" style="color:var(--fg-muted); font-size:0.9rem; line-height:1.65; margin:0; padding:0.875rem 1.5rem 0;"></p>
      <div style="padding:1rem 1.5rem 1.5rem;">
        <p style="color:var(--fg); font-size:0.75rem; font-weight:600; text-transform:uppercase; letter-spacing:0.07em; margin:0 0 0.75rem;">Key Highlights</p>
        <ul id="modal-highlights" style="margin:0; padding-left:1.25rem; display:flex; flex-direction:column; gap:0.5rem; list-style-type:disc;"></ul>
      </div>
    </div>
  </div>
</BaseLayout>

<script is:inline>
  (function () {
    var backdrop = document.getElementById('project-modal-backdrop');
    var modal    = document.getElementById('project-modal');

    function openModal(card) {
      document.getElementById('modal-title').textContent = card.dataset.title;
      document.getElementById('modal-meta').textContent  = card.dataset.company + ' ¬∑ ' + card.dataset.role + ' ¬∑ ' + card.dataset.period;
      document.getElementById('modal-description').textContent = card.dataset.description;

      var techEl = document.getElementById('modal-tech');
      techEl.innerHTML = '';
      card.dataset.tech.split('||').forEach(function (t) {
        var s = document.createElement('span');
        s.className = 'tag';
        s.textContent = t.trim();
        techEl.appendChild(s);
      });

      var hlEl = document.getElementById('modal-highlights');
      hlEl.innerHTML = '';
      JSON.parse(card.dataset.highlights).forEach(function (h) {
        var li = document.createElement('li');
        li.style.cssText = 'color:var(--fg-muted); font-size:0.875rem; line-height:1.65;';
        li.textContent = h;
        hlEl.appendChild(li);
      });

      backdrop.style.display = 'flex';
      requestAnimationFrame(function () {
        requestAnimationFrame(function () {
          modal.style.transform = 'scale(1)';
          modal.style.opacity   = '1';
        });
      });
      document.body.style.overflow = 'hidden';
    }

    function closeModal() {
      modal.style.transform = 'scale(0.95)';
      modal.style.opacity   = '0';
      setTimeout(function () {
        backdrop.style.display = 'none';
        document.body.style.overflow = '';
      }, 200);
    }

    document.querySelectorAll('.project-card').forEach(function (card) {
      card.addEventListener('click', function () { openModal(card); });
    });
    document.getElementById('modal-close').addEventListener('click', closeModal);
    backdrop.addEventListener('click', function (e) { if (e.target === backdrop) closeModal(); });
    document.addEventListener('keydown', function (e) { if (e.key === 'Escape') closeModal(); });
  })();
</script>
